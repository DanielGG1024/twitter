(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-745a2810"],{2085:function(t,e,a){},2797:function(t,e,a){"use strict";var s=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("transition",{attrs:{name:"fade"}},[s("div",{directives:[{name:"show",rawName:"v-show",value:t.ReplyModalSwitch,expression:"ReplyModalSwitch"}],staticClass:"modal-background",on:{click:t.clickModalBackground}},[s("div",{staticClass:"modal"},[s("div",{staticClass:"modal-header"},[s("div",{staticClass:"close-icon",on:{click:t.clickClose}},[s("img",{staticClass:"close",attrs:{src:a("98f5"),alt:""}})])]),s("div",{staticClass:"reply"},[s("div",{staticClass:"reply-icon-wrapper"},[s("img",{staticClass:"user-icon",attrs:{src:t.tweet.User.avatar,alt:""}})]),s("div",{staticClass:"txt-wrapper"},[s("div",{staticClass:"txt-info"},[s("span",{staticClass:"user-name"}),s("span",{staticClass:"user-account"},[t._v("＠"+t._s(t.tweet.User.account)+" "),s("span",[t._v("．"+t._s(t._f("fromYear")(t.tweet.createdAt)))])])]),s("div",{staticClass:"txt"},[s("p",[t._v(" "+t._s(t.tweet.description)+" ")])]),s("div",{staticClass:"txt-footer"},[s("span",{staticClass:"txt-footer-reply"},[t._v("回覆給")]),s("span",{staticClass:"footer-account"},[t._v("＠"+t._s(t.tweet.User.account))])])])]),s("div",{staticClass:"modal-txt"},[s("div",{staticClass:"modal-content-post"},[s("div",{staticClass:"modal-main-tweet"},[s("div",{staticClass:"user-icon-wrapper"},[s("img",{staticClass:"user-icosn",attrs:{src:t.currentUser.avatar,alt:""}})]),s("div",{staticClass:"modal-main-tweet-txt"},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.teweetContent,expression:"teweetContent"}],staticClass:"modal-textarea",attrs:{placeholder:"有甚麼新鮮事?"},domProps:{value:t.teweetContent},on:{input:function(e){e.target.composing||(t.teweetContent=e.target.value)}}}),s("span",{directives:[{name:"show",rawName:"v-show",value:t.contentError,expression:"contentError"}],staticClass:"modal-info"},[t._v(t._s(t.errorContentMessage))])]),s("button",{staticClass:"modal-main-tweet-button",attrs:{disabled:t.isProcessing},on:{click:function(e){return t.handleSubmit(t.tweet.TweetId)}}},[t._v(" 推文 ")])])])])])])])},n=[],r=a("1da1"),i=a("5530"),o=(a("96cf"),a("498a"),a("7482")),c=a("2fa3"),l=a("2f62"),u=a("2708"),d={name:"ReplyModal",mixins:[u["b"]],props:{ReplyModalSwitch:{type:Boolean,required:!0},tweet:{type:Object}},data:function(){return{teweetContent:"",contentError:!1,errorContentMessage:"",isProcessing:!1}},computed:Object(i["a"])({},Object(l["b"])(["currentUser","isAuthenticated"])),methods:{clickClose:function(){this.$emit("after-click-close")},clickModalBackground:function(t){var e=t.target;"modal-background"===e.className&&this.$emit("after-click-background")},handleSubmit:function(t){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function a(){var s,n,r,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(s=e.teweetContent,0!==s.trim().length){a.next=7;break}return e.contentError=!0,e.errorContentMessage="內容不可以空白",a.abrupt("return");case 7:if(!(s.length>140)){a.next=11;break}return e.contentError=!0,e.errorContentMessage="字數不可超過140字",a.abrupt("return");case 11:e.contentError=!1,e.errorContentMessage="";case 13:return a.prev=13,n='{\n          "comment":"'.concat(s,'"\n        }'),r=JSON.parse(n),a.next=18,o["a"].postTweetReply({tweetId:t,data_JSON:r});case 18:if(i=a.sent,"success"===i.data.status){a.next=21;break}throw new Error;case 21:e.$emit("after-tweetReply-post"),e.teweetContent="",e.isProcessing=!0,c["a"].fire({icon:"success",title:"發送成功!"}),a.next=31;break;case 27:a.prev=27,a.t0=a["catch"](13),c["a"].fire({icon:"error",title:"無法回復,請稍後"}),e.isProcessing=!1;case 31:case"end":return a.stop()}}),a,null,[[13,27]])})))()}}},p=d,w=(a("6770"),a("2877")),f=Object(w["a"])(p,s,n,!1,null,"63f8adec",null);e["a"]=f.exports},6770:function(t,e,a){"use strict";a("e2dd")},"68b0":function(t,e,a){},"7db0":function(t,e,a){"use strict";var s=a("23e7"),n=a("b727").find,r=a("44d2"),i="find",o=!0;i in[]&&Array(1)[i]((function(){o=!1})),s({target:"Array",proto:!0,forced:o},{find:function(t){return n(this,t,arguments.length>1?arguments[1]:void 0)}}),r(i)},a03b:function(t,e,a){"use strict";a("f622")},b683:function(t,e,a){"use strict";a("68b0")},cd56:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"main"},[a("div",{staticClass:"main-container"},[a("Menu",{on:{"after-tweet-post":t.afterTweetPost}}),a("main",{staticClass:"content"},[a("div",{staticClass:"content-post"},[t._m(0),a("MainTweetPost",{on:{"after-tweet-post":t.afterTweetPost}})],1),t.isLoading?a("Spinner"):a("MainTweets",{attrs:{allTweets:t.allTweets},on:{"after-tweetReply-post":t.afterTweetPost}})],1),a("Popular")],1)])},n=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"content-header"},[a("span",{staticClass:"title"},[t._v("首頁")])])}],r=a("1da1"),i=(a("96cf"),a("fb62")),o=a("3b8f"),c=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"main-tweet"},[a("div",{staticClass:"user-icon-wrapper"},[a("img",{staticClass:"user-icon",attrs:{src:t.currentUser.avatar,alt:""}})]),a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.mainTweetPost,expression:"mainTweetPost"}],staticClass:"main-tweet-txt",attrs:{name:"",id:"",value:"hello",placeholder:"有甚麼新鮮事?"},domProps:{value:t.mainTweetPost},on:{input:function(e){e.target.composing||(t.mainTweetPost=e.target.value)}}}),a("button",{staticClass:"main-tweet-button",on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.handleSubmit.apply(null,arguments)}}},[t._v(" 推文 ")]),a("p")])},l=[],u=a("2fa3"),d=a("7482"),p=a("2f62"),w={name:"MainTweetPost",data(){return{mainTweetPost:"",avatar:""}},computed:{...Object(p["b"])(["currentUser","isAuthenticated"])},methods:{async handleSubmit(){const t=this.mainTweetPost;if(t.trim().length<1)u["a"].fire({icon:"warning",title:"內容不能為空白"});else if(t.length>140)u["a"].fire({icon:"warning",title:"內容不能超過140個字"});else try{const e=`{\n          "description":"${t}"\n        }`,a=JSON.parse(e),s=await d["a"].postTweet({data_JSON:a});if(console.log("maintweetpost"),"success"!==s.data.status)throw new Error;u["a"].fire({icon:"success",title:"發送成功!"}),this.$emit("after-tweet-post"),this.mainTweetPost=""}catch{u["a"].fire({icon:"error",title:"無法送出推文,請稍後"})}}}},f=w,m=(a("a03b"),a("2877")),v=Object(m["a"])(f,c,l,!1,null,"580c499e",null),h=v.exports,C=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{ref:"chat",staticClass:"tweets scrollbar"},[t._l(t.allTweets,(function(e){return s("div",{key:e.TweetId,staticClass:"onetweet"},[s("div",{staticClass:"onetweet-user-icon-wrapper"},[s("router-link",{attrs:{to:{name:"Reply",params:{id:e.TweetId}}}},[s("img",{staticClass:"user-icon",attrs:{src:e.User.avatar,alt:""}})])],1),s("div",{staticClass:"onetweet-txt-wrapper"},[s("div",{staticClass:"onetweet-txt-header"},[s("router-link",{attrs:{to:{name:"Reply",params:{id:e.TweetId}}}},[s("span",{staticClass:"user-title"},[t._v(t._s(e.User.name))]),s("span",{staticClass:"user-info"},[s("a",{staticClass:"user-link",attrs:{href:"#"}},[t._v(" ＠"+t._s(e.User.account))]),s("span",{staticClass:"user-link-time"},[t._v("．"+t._s(t._f("fromNow")(e.createdAt)))])])])],1),s("router-link",{attrs:{to:{name:"Reply",params:{id:e.TweetId}}}},[s("div",{staticClass:"onetweet-txt"},[t._v(" "+t._s(e.description)+" ")])]),s("div",{staticClass:"onetweet-footer"},[s("div",{staticClass:"chat"},[s("div",{staticClass:"onetweet-footer-icon"},[s("img",{staticClass:"chat-icon",attrs:{src:a("b74f"),alt:""},on:{click:function(a){return t.clickChatBtn(e.TweetId)}}})]),s("span",{staticClass:"footer-amount"},[t._v(t._s(e.RepliesCount))])]),s("div",{staticClass:"heart"},[s("div",{staticClass:"onetweet-footer-icon"},[e.isLiked?s("img",{staticClass:"heart-icon",attrs:{src:a("4167"),alt:"heart-icon",disabled:t.isProcessing},on:{click:function(a){return a.stopPropagation(),a.preventDefault(),t.removeLike(e)}}}):s("img",{staticClass:"heart-icon",attrs:{src:a("b4af"),alt:"heart-icon",disabled:t.isProcessing},on:{click:function(a){return a.stopPropagation(),a.preventDefault(),t.addLike(e)}}})]),s("span",{staticClass:"footer-amount"},[t._v(t._s(e.LikesCount))])])])],1)])})),s("ReplyModal",{attrs:{ReplyModalSwitch:t.ReplyModal,tweet:t.tweet},on:{"after-click-background":t.afterClickClose,"after-click-close":t.afterClickClose,"after-tweetReply-post":t.afterTweetReplyPost}})],2)},g=[],k=(a("7db0"),a("2797")),b=a("2708"),_={name:"MainTweets",mixins:[b["b"]],components:{ReplyModal:k["a"]},props:{allTweets:{type:Array,require:!0}},data:function(){return{ReplyModal:!1,tweet:{User:{avatar:""}},isProcessing:!1}},methods:{clickChatBtn:function(t){this.ReplyModal=!0,this.tweet=this.allTweets.find((function(e){return e.TweetId===t})),console.log("clickChatBtn",this.tweet)},afterClickClose:function(){this.ReplyModal=!1},afterTweetReplyPost:function(){this.ReplyModal=!1,this.$emit("after-tweetReply-post")},addLike:function(t){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function a(){var s,n,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return console.log("tweet",t),a.prev=1,e.isProcessing=!0,s=t.TweetId,a.next=6,d["a"].addLike({tweetId:s});case 6:if(n=a.sent,r=n.data,console.log("add data",r),"success"===r.status){a.next=11;break}throw new Error(r.message);case 11:t.LikesCount+=1,t.isLiked=!0,e.isProcessing=!1,a.next=21;break;case 16:a.prev=16,a.t0=a["catch"](1),e.isProcessing=!1,console.log(a.t0),u["a"].fire({icon:"error",title:"無法喜歡,請稍後在試"});case 21:case"end":return a.stop()}}),a,null,[[1,16]])})))()},removeLike:function(t){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function a(){var s,n,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return console.log("tweet",t),a.prev=1,e.isProcessing=!0,s=t.TweetId,a.next=6,d["a"].removeLike({tweetId:s});case 6:if(n=a.sent,console.log("delete reponse",n),r=n.data,"success"===r.status){a.next=11;break}throw new Error(r.message);case 11:t.isLiked=!1,t.LikesCount-=1,e.isProcessing=!1,a.next=21;break;case 16:a.prev=16,a.t0=a["catch"](1),e.isProcessing=!1,console.log(a.t0),u["a"].fire({icon:"error",title:"無法取消喜歡,請稍後在試"});case 21:case"end":return a.stop()}}),a,null,[[1,16]])})))()}}},x=_,T=(a("b683"),Object(m["a"])(x,C,g,!1,null,"41e2d2e0",null)),P=T.exports,y=a("2375"),R={namd:"main",components:{Menu:i["a"],Popular:o["a"],MainTweetPost:h,MainTweets:P,Spinner:y["a"]},data:function(){return{isLoading:!0,allTweets:[],tweet:{}}},created:function(){this.fetchTweets()},methods:{fetchTweets:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){var a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,d["a"].getTweets();case 3:a=e.sent,s=a.data,t.allTweets=s,t.isLoading=!1,e.next=13;break;case 9:e.prev=9,e.t0=e["catch"](0),t.isLoading=!1,u["a"].fire({icon:"warning",title:"tweets錯誤唷"});case 13:case"end":return e.stop()}}),e,null,[[0,9]])})))()},afterTweetPost:function(){this.fetchTweets()}}},M=R,L=(a("fe02"),Object(m["a"])(M,s,n,!1,null,"0bb9981e",null));e["default"]=L.exports},e2dd:function(t,e,a){},f622:function(t,e,a){},fe02:function(t,e,a){"use strict";a("2085")}}]);
//# sourceMappingURL=chunk-745a2810.8d03b8e8.js.map